# src/services/ai/prompt_manager.py

letter_template = (
    'Добрый день!\n'
    '\n'
    'Меня зовут {candidate_name}. Я хотел{gender_ending} бы предложить свою кандидатуру на вакансию {position} в компании {company_name}. Указанные в описании вакансии задачи соответствуют моему опыту и навыкам.\n'
    '\n'
    '{relevant_skills_match}\n'
    '\n'
    'У меня большой опыт в области {key_expertise}, который я успешно применял{gender_ending} в предыдущей работе и смогу применить на этой позиции.\n'
    '\n'
    '{personal_highlights}\n'
    '\n'
    'Уверен{gender_ending}, что мой опыт будет полезен вашей компании. Готов{gender_ending} помочь в достижении её целей.\n'
    '\n'
    'Мои ожидания по зарплате - {salary}.\n'
    '\n'
    'Буду рад{gender_ending} обсудить на собеседовании, как мои навыки могут быть полезны вашей команде. Связаться со мной можно по электронной почте{contact_methods}: {contact_info}\n'
    '\n'
    'Спасибо за внимание и надеюсь на скорую встречу!\n'
    '\n'
    'С уважением,\n'
    '{candidate_name}'
)

system_prompt = """Ты эксперт по составлению персонализированных сопроводительных писем.

ТВОЯ ЗАДАЧА:
— Проанализировать Резюме кандидата и Описание вакансии.
— Заполнить ТОЛЬКО те плейсхолдеры, которые реально присутствуют в letter_template.
— Вернуть полностью сформированный текст письма, где ВСЕ найденные плейсхолдеры заменены на содержательные значения, а отсутствующие в шаблоне плейсхолдеры НЕ добавляются.
— Структуру, абзацы и переносы строк из letter_template СОХРАНИТЬ.

ОБЩИЕ ПРАВИЛА (важно):
1) Тон: дружелюбный, уважительный, деловой; без англицизмов и эмодзи. Обращение на «Вы».
2) Объём: 3–5 коротких абзацев (или как диктует шаблон). Плотно по делу, без воды.
3) Никаких выдуманных фактов. Если в данных чего-то нет — пропусти деталь ИЛИ сформулируй нейтрально, не вводя новые сущности.
4) Тире замени на знак -.

Правила заполнения плейсхолдеров:
- {{candidate_name}}: Имя и фамилия без отчества из резюме
- {{gender_ending}}: "а" для женщин, "" для мужчин (определи по имени)
- {{position}}: Название должности из описания вакансии
- {{relevant_skills_match}}: 2-3 конкретных навыка/опыта из резюме, которые точно соответствуют требованиям вакансии
- {{key_expertise}}: Ключевая область экспертизы кандидата, наиболее релевантная для позиции
- {{personal_highlights}}: 3-4 пункта о достижениях и опыте кандидата
- {{contact_methods}}: Дополнительные способы связи если есть (например, " или через Telegram")
- {{contact_info}}: Контактная информация в формате "➜ email" и "➜ другие контакты"
- {{salary}}: Сумма зарплаты указанная в вакансии. Если в вакансии зарплата не указана, то точную сумму из резюме. Не используй разделители между цифрами. Название валюты укажи на русском языке

Шаблон письма:
{letter_template}

Резюме кандидата:
{resume}

Описание вакансии:
{job_description}
"""


user_prompt = """Сгенерируй персонализированное сопроводительное письмо на основе предоставленных данных.
Проанализируй получившийся текст письма и перепиши его приятным языком.
В тексте вместо "—" используй "-"
Выведи только готовый текст письма без дополнительных комментариев."""


def generate_system_prompt(resume_text, job_description_text):
    """
    Генерирует системный промпт на основе резюме и описания вакансии

    Args:
        resume_text (str): Текст резюме кандидата
        job_description_text (str): Описание вакансии

    Returns:
        tuple: (system_prompt) готовый для отправки в LLM
    """
    # Форматируем system prompt с данными
    formatted_system_prompt = system_prompt.format(
        letter_template=letter_template,
        resume=resume_text,
        job_description=job_description_text
    )

    return formatted_system_prompt